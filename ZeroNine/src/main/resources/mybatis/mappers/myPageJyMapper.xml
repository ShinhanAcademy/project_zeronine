<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.zeronine.mypage">
	<!-- ecocare dash -->
	<select id="selectEcoInfoAll" parameterType="String" resultType="map">
		select p.*, cpc."isSubscription", cpc."remainingCouponCount"
		from public.pickup as p
		join public."customerPickCoupon" as cpc on p."customerId" = cpc."customerId" and p."subscriptionId" = cpc."subscriptionId"
		where p."customerId"= cast(#{customerId} as UUID) and "pickUpStatus"='complete' 
	</select>
	<select id="selectCouponCtn" resultType="map">
	select  p."subscriptionId",p."customerId",cpc."isSubscription", cpc."remainingCouponCount"
		from public.pickup as p
		join public."customerPickCoupon" as cpc on p."subscriptionId" = cpc."subscriptionId"
		where p."customerId"= cast(#{customerId} as UUID) and cpc."remainingCouponCount" > 0
		group by p."subscriptionId",p."customerId",cpc."subscriptionId", cpc."remainingCouponCount"
	</select>
</mapper>